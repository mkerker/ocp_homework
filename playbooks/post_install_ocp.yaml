#
# post_install_ocp.yaml
#
---
- name: Create PVs for Users
  hosts: nfs
  tasks:
    - name: "Create PV directories and add them to be exported"
      script: ./scripts/create_pvs.sh
    - name: Restarting NFS Server...
      shell: systemctl restart nfs-server
  tags:
    - nfs

- name: Create 25 definitions files for PVs 5G size
  hosts: localhost
  tasks:
    - name: "Creating the files.."
      script: ./scripts/pvs_5Gsize.sh

- name: Create 25 definitions files for PVs 10G size
  hosts: localhost
  tasks:
    - name: "Creating the files.."
      script: ./scripts/pvs_10Gsize.sh

- name: Create all PVs from definitions files
  hosts: localhost
  tasks:
    - name: "Creating PVs from the files.."
      shell: "cat /root/pvs/* | oc create -f -"

- name: Fix NFS Persistent Volume Recycling
  hosts: nodes
  tasks:
    - name: "pull the recycler image"
      shell: docker pull registry.access.redhat.com/openshift3/ose-recycler:latest
    - name: "tag the recycler image for specific version"
      shell: docker tag registry.access.redhat.com/openshift3/ose-recycler:latest registry.access.redhat.com/openshift3/ose-recycler:v3.10.34
  tags:
    - fixnfs
